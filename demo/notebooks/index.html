



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Event-Driven Parameterized Jupyter Notebooks - Argo Events - The Event-Based Dependency Manager for Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.750b69bd.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700|">
        <style>body,input{font-family:"Work Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105170809-2", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#event-driven-parameterized-jupyter-notebooks" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Argo Events - The Event-Based Dependency Manager for Kubernetes" class="md-header-nav__button md-logo">
          
            <img src="../../assets/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Argo Events - The Event-Based Dependency Manager for Kubernetes
            </span>
            <span class="md-header-nav__topic">
              Event-Driven Parameterized Jupyter Notebooks
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/argoproj/argo-events/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Argo Events - The Event-Based Dependency Manager for Kubernetes" class="md-nav__button md-logo">
      
        <img src="../../assets/logo.png" width="48" height="48">
      
    </a>
    Argo Events - The Event-Based Dependency Manager for Kubernetes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/argoproj/argo-events/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick_start/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../concepts/gateway/" title="Gateway" class="md-nav__link">
      Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../concepts/sensor/" title="Sensor" class="md-nav__link">
      Sensor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../concepts/event_source/" title="Event Source" class="md-nav__link">
      Event Source
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/amqp/" title="AMQP" class="md-nav__link">
      AMQP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/aws-sns/" title="AWS SNS" class="md-nav__link">
      AWS SNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/aws-sqs/" title="AWS SQS" class="md-nav__link">
      AWS SQS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/calendar/" title="Calendar" class="md-nav__link">
      Calendar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/emitter/" title="Emitter" class="md-nav__link">
      Emitter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/file/" title="File" class="md-nav__link">
      File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/gcp-pub-sub/" title="GCP PubSub" class="md-nav__link">
      GCP PubSub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/github/" title="GitHub" class="md-nav__link">
      GitHub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/gitlab/" title="GitLab" class="md-nav__link">
      GitLab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/kafka/" title="Kafka" class="md-nav__link">
      Kafka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/minio/" title="Minio" class="md-nav__link">
      Minio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/mqtt/" title="MQTT" class="md-nav__link">
      MQTT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/nats/" title="NATS" class="md-nav__link">
      NATS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/nsq/" title="NSQ" class="md-nav__link">
      NSQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/resource/" title="Resource" class="md-nav__link">
      Resource
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/webhook/" title="Webhook" class="md-nav__link">
      Webhook
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Demo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Demo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Event-Driven Parameterized Jupyter Notebooks" class="md-nav__link md-nav__link--active">
      Event-Driven Parameterized Jupyter Notebooks
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/01-introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/02-parameterization/" title="Parameterization" class="md-nav__link">
      Parameterization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/03-trigger-sources/" title="Trigger Sources" class="md-nav__link">
      Trigger Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/04-standard-k8s-resources/" title="Standard K8s Resources" class="md-nav__link">
      Standard K8s Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/05-trigger-custom-resources/" title="Trigger Custom Resources" class="md-nav__link">
      Trigger Custom Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/06-circuit-and-switch/" title="Circuit and Switch" class="md-nav__link">
      Circuit and Switch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/07-filters/" title="Filters" class="md-nav__link">
      Filters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/08-policy/" title="Policy" class="md-nav__link">
      Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/09-http-trigger/" title="HTTP Trigger" class="md-nav__link">
      HTTP Trigger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/10-aws-lambda-and-openfaas-trigger/" title="AWS Lambda Trigger" class="md-nav__link">
      AWS Lambda Trigger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/11-special-argo-workflow-trigger/" title="Special Argo Workflow Trigger" class="md-nav__link">
      Special Argo Workflow Trigger
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../developer_guide/" title="Developer Guide" class="md-nav__link">
      Developer Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../controllers/" title="Controllers" class="md-nav__link">
      Controllers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../FAQ/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/argoproj/argo-events/releases" title="Releases ⧉" class="md-nav__link">
      Releases ⧉
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/argoproj/argo-events/milestones" title="Roadmap ⧉" class="md-nav__link">
      Roadmap ⧉
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://blog.argoproj.io/" title="Blog ⧉" class="md-nav__link">
      Blog ⧉
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/argoproj/argo-events/edit/master/docs/demo/notebooks.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="event-driven-parameterized-jupyter-notebooks">Event-Driven Parameterized Jupyter Notebooks<a class="headerlink" href="#event-driven-parameterized-jupyter-notebooks" title="Permanent link">&para;</a></h1>
<p>Jupyter notebooks are prevalent in data science community to develop models, run analysis and generate reports, etc.
But in many situations, a data scientist must feed varying parameters to tune the notebook to generate an optimal model. 
Tools like <a href="https://papermill.readthedocs.io/en/latest/">papermill</a> makes it easy to parameterize the notebook and Argo Events makes it super easy
to set up <strong>event-driven</strong> parameterized notebooks.</p>
<h1 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h1>
<ol>
<li>Install <a href="https://github.com/argoproj/argo/blob/master/docs/getting-started.md">Argo Workflows</a>.</li>
<li>Install <a href="https://argoproj.github.io/argo-events/installation/">Argo Events</a>.</li>
<li>
<p>Install NATS,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/nats-deploy.yaml
</pre></div>


</li>
<li>
<p>Port forward to NATS pod,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events port-forward &lt;nats-pod-name&gt; 4222:4222
</pre></div>


</li>
<li>
<p>Install Minio,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/artifact-minio.yaml

kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/minio-deploy.yaml
</pre></div>


</li>
<li>
<p>Port forward to Minio pod,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events port-forward &lt;minio-pod-name&gt; 9000:9000
</pre></div>


</li>
</ol>
<h1 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h1>
<p>In this demo, we are going to set up an image processing pipeline using 2 notebooks. Lets consider the ArgoProj icon image</p>
<p><br/>
<br/></p>
<p align="center">
  <img src="https://github.com/argoproj/argo-events/blob/master/docs/assets/argo.png?raw=true" alt="Argo"/>
</p>

<p><br/>
<br/></p>
<ol>
<li>The <a href="https://github.com/VaibhavPage/argo-events-demo/blob/master/img-out.ipynb">first notebook</a> will take the clean ArgoProj logo and add noise to it.</li>
<li>The <a href="https://github.com/VaibhavPage/argo-events-demo/blob/master/matcher.ipynb">second notebook</a> is going to determine the similarity between clean image and the image with noise.
   If the match is &gt; 80%, then model is optimal, else we need to tune the noise parameters.</li>
</ol>
<p><br/></p>
<p align="center">
  <img src="https://github.com/VaibhavPage/argo-events-demo/blob/master/out/argo-demo.png?raw=true" alt="Argo Demo"/>
</p>

<p><br/></p>
<ol>
<li>
<p>We will set up two gateways, Webhook and Minio. The webhook gateway will listen to HTTP requests to tune the 
   notebook to add noise to image. The notebook will store the noisy image to Minio.</p>
</li>
<li>
<p>The minio gateway will listen to file drop events for a specific bucket. Once the noisy image is dropped into that bucket,
   we will run the second notebook that determines the similarity of images.</p>
</li>
</ol>
<p><br/></p>
<p align="center">
  <img src="https://github.com/VaibhavPage/argo-events-demo/blob/master/argo-events-demo-pipeline.png?raw=true" alt="Argo Demo"/>
</p>

<p><br/></p>
<ol>
<li>
<p>Create webhook event source. It consist configuration for gateway to listen for HTTP POST requests on port 12000.</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/webhook-event-source.yaml
</pre></div>


</li>
<li>
<p>Create webhook gateway,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/webhook-gateway.yaml
</pre></div>


</li>
<li>
<p>Port forward to webhook gateway pod,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events port-forward &lt;webhook-gateway-pod-name&gt; 12000:12000
</pre></div>


</li>
<li>
<p>Create webhook sensor,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/webhook-sensor.yaml
</pre></div>


</li>
<li>
<p>Lets inspect webhook sensor,</p>
<div class="codehilite"><pre><span></span><span class="n">apiVersion</span><span class="o">:</span> <span class="n">argoproj</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">Sensor</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">webhook</span><span class="o">-</span><span class="n">sensor</span>
  <span class="n">labels</span><span class="o">:</span>
    <span class="n">sensors</span><span class="o">.</span><span class="na">argoproj</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">sensor</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">instanceid</span><span class="o">:</span> <span class="n">argo</span><span class="o">-</span><span class="n">events</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">template</span><span class="o">:</span>
    <span class="n">spec</span><span class="o">:</span>
      <span class="n">containers</span><span class="o">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">sensor</span>
          <span class="n">image</span><span class="o">:</span> <span class="n">argoproj</span><span class="o">/</span><span class="n">sensor</span><span class="o">:</span><span class="n">v0</span><span class="o">.</span><span class="mf">13.0</span><span class="o">-</span><span class="n">rc</span>
          <span class="n">imagePullPolicy</span><span class="o">:</span> <span class="n">Always</span>
      <span class="n">serviceAccountName</span><span class="o">:</span> <span class="n">argo</span><span class="o">-</span><span class="n">events</span><span class="o">-</span><span class="n">sa</span>
  <span class="n">dependencies</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">test</span><span class="o">-</span><span class="n">dep</span>
      <span class="n">gatewayName</span><span class="o">:</span> <span class="n">webhook</span><span class="o">-</span><span class="n">gateway</span>
      <span class="n">eventName</span><span class="o">:</span> <span class="n">example</span>
  <span class="n">subscription</span><span class="o">:</span>
    <span class="n">http</span><span class="o">:</span>
      <span class="n">port</span><span class="o">:</span> <span class="mi">9300</span>
  <span class="n">triggers</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">template</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">webhook</span><span class="o">-</span><span class="n">workflow</span><span class="o">-</span><span class="n">trigger</span>
        <span class="n">k8s</span><span class="o">:</span>
          <span class="n">group</span><span class="o">:</span> <span class="n">argoproj</span><span class="o">.</span><span class="na">io</span>
          <span class="n">version</span><span class="o">:</span> <span class="n">v1alpha1</span>
          <span class="n">resource</span><span class="o">:</span> <span class="n">workflows</span>
          <span class="n">operation</span><span class="o">:</span> <span class="n">create</span>
          <span class="n">source</span><span class="o">:</span>
            <span class="n">resource</span><span class="o">:</span>
              <span class="n">apiVersion</span><span class="o">:</span> <span class="n">argoproj</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">v1alpha1</span>
              <span class="n">kind</span><span class="o">:</span> <span class="n">Workflow</span>
              <span class="n">metadata</span><span class="o">:</span>
                <span class="n">generateName</span><span class="o">:</span> <span class="n">webhook</span><span class="o">-</span>
              <span class="n">spec</span><span class="o">:</span>
                <span class="n">entrypoint</span><span class="o">:</span> <span class="n">noisy</span>
                <span class="k">arguments</span><span class="o">:</span>
                  <span class="n">parameters</span><span class="o">:</span>
                    <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">filterA</span>
                      <span class="n">value</span><span class="o">:</span> <span class="s2">&quot;5&quot;</span>
                    <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">filterB</span>
                      <span class="n">value</span><span class="o">:</span> <span class="s2">&quot;5&quot;</span>
                    <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">sVSp</span>
                      <span class="n">value</span><span class="o">:</span> <span class="s2">&quot;0.5&quot;</span>
                    <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">amount</span>
                      <span class="n">value</span><span class="o">:</span> <span class="s2">&quot;0.004&quot;</span>
                <span class="n">templates</span><span class="o">:</span>
                  <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">noisy</span>
                    <span class="n">serviceAccountName</span><span class="o">:</span> <span class="n">argo</span><span class="o">-</span><span class="n">events</span><span class="o">-</span><span class="n">sa</span>
                    <span class="n">inputs</span><span class="o">:</span>
                      <span class="n">parameters</span><span class="o">:</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">filterA</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">filterB</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">sVSp</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">amount</span>
                    <span class="n">container</span><span class="o">:</span>
                      <span class="n">image</span><span class="o">:</span> <span class="n">metalgearsolid</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">blur</span><span class="o">-</span><span class="n">argo</span><span class="o">-</span><span class="n">logo</span><span class="o">:</span><span class="n">latest</span>
                      <span class="n">command</span><span class="o">:</span> <span class="o">[</span><span class="n">papermill</span><span class="o">]</span>
                      <span class="n">imagePullPolicy</span><span class="o">:</span> <span class="n">Always</span>
                      <span class="n">env</span><span class="o">:</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">AWS_ACCESS_KEY_ID</span>
                          <span class="n">value</span><span class="o">:</span> <span class="n">minio</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">AWS_SECRET_ACCESS_KEY</span>
                          <span class="n">value</span><span class="o">:</span> <span class="n">minio123</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">AWS_DEFAULT_REGION</span>
                          <span class="n">value</span><span class="o">:</span> <span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
                        <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">BOTO3_ENDPOINT_URL</span>
                          <span class="n">value</span><span class="o">:</span> <span class="n">http</span><span class="o">://</span><span class="n">minio</span><span class="o">-</span><span class="n">service</span><span class="o">.</span><span class="na">argo</span><span class="o">-</span><span class="n">events</span><span class="o">.</span><span class="na">svc</span><span class="o">:</span><span class="mi">9000</span>
                      <span class="n">args</span><span class="o">:</span>
                        <span class="o">-</span> <span class="s2">&quot;noise.ipynb&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;s3://output/noisy-out.ipynb&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;-p&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;filterA&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;{{inputs.parameters.filterA}}&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;-p&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;filterB&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;{{inputs.parameters.filterB}}&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;-p&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;sVSp&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;{{inputs.parameters.sVSp}}&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;-p&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;amount&quot;</span>
                        <span class="o">-</span> <span class="s2">&quot;{{inputs.parameters.amount}}&quot;</span>
          <span class="n">parameters</span><span class="o">:</span>
            <span class="o">-</span> <span class="n">src</span><span class="o">:</span>
                <span class="n">dependencyName</span><span class="o">:</span> <span class="n">test</span><span class="o">-</span><span class="n">dep</span>
                <span class="n">dataKey</span><span class="o">:</span> <span class="n">body</span><span class="o">.</span><span class="na">filterA</span>
              <span class="n">dest</span><span class="o">:</span> <span class="n">spec</span><span class="o">.</span><span class="na">arguments</span><span class="o">.</span><span class="na">parameters</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="na">value</span>
            <span class="o">-</span> <span class="n">src</span><span class="o">:</span>
                <span class="n">dependencyName</span><span class="o">:</span> <span class="n">test</span><span class="o">-</span><span class="n">dep</span>
                <span class="n">dataKey</span><span class="o">:</span> <span class="n">body</span><span class="o">.</span><span class="na">filterB</span>
              <span class="n">dest</span><span class="o">:</span> <span class="n">spec</span><span class="o">.</span><span class="na">arguments</span><span class="o">.</span><span class="na">parameters</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="na">value</span>
            <span class="o">-</span> <span class="n">src</span><span class="o">:</span>
                <span class="n">dependencyName</span><span class="o">:</span> <span class="n">test</span><span class="o">-</span><span class="n">dep</span>
                <span class="n">dataKey</span><span class="o">:</span> <span class="n">body</span><span class="o">.</span><span class="na">sVSp</span>
              <span class="n">dest</span><span class="o">:</span> <span class="n">spec</span><span class="o">.</span><span class="na">arguments</span><span class="o">.</span><span class="na">parameters</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">value</span>
            <span class="o">-</span> <span class="n">src</span><span class="o">:</span>
                <span class="n">dependencyName</span><span class="o">:</span> <span class="n">test</span><span class="o">-</span><span class="n">dep</span>
                <span class="n">dataKey</span><span class="o">:</span> <span class="n">body</span><span class="o">.</span><span class="na">amount</span>
              <span class="n">dest</span><span class="o">:</span> <span class="n">spec</span><span class="o">.</span><span class="na">arguments</span><span class="o">.</span><span class="na">parameters</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="na">value</span>
</pre></div>


</li>
<li>
<p>The sensor trigger is an Argo workflow that runs a jupyter notebook with papermill.
   It takes arguments for Guassian filter and Slat+Pepper noise in addition to S3 configuration.
   The event data received from HTTP POST request is made to override the arguments to workflow on the fly.</p>
</li>
<li>
<p>Lets configurre Minio client mc,</p>
<div class="codehilite"><pre><span></span> mc config host add minio http://localhost:9000 minio minio123
</pre></div>


</li>
<li>
<p>Create a bucket on Minio called <code>output</code>.</p>
<div class="codehilite"><pre><span></span>mc mb minio/output
</pre></div>


</li>
<li>
<p>Create the Minio event source that makes the gateway listen to file events for <code>output</code> bucket,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/minio-event-source.yaml
</pre></div>


</li>
<li>
<p>Create Minio gateway</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/minio-gateway.yaml
</pre></div>


</li>
<li>
<p>Create Minio sensor,</p>
<div class="codehilite"><pre><span></span>kubectl -n argo-events apply -f https://raw.githubusercontent.com/VaibhavPage/argo-events-demo/master/minio-sensor.yaml
</pre></div>


</li>
<li>
<p>The Minio sensor triggers an Argo workflow that determines the similarity index of the image that was put onto <code>noisy-bucket</code> on Minio
   and the original Argo logo. If the match is less than 80%, it publishes failure message on NATS subject called <code>image-match</code>        </p>
</li>
<li>
<p>Run a NATS subject subscriber in a separate terminal,</p>
<div class="codehilite"><pre><span></span>go get github.com/nats-io/nats.go/

cd examples/nats-sub

go run main.go -s localhost:4222 image-match
</pre></div>


</li>
<li>
<p>Now, its time to send a HTTP request to parameterize the notebook that add noise to original Argo logo and execute the image processing pipeline.</p>
<div class="codehilite"><pre><span></span>curl -d &#39;{&quot;filterA&quot;:&quot;15&quot;, &quot;filterB&quot;: &quot;15&quot;, &quot;sVSp&quot;: &quot;0.003&quot;, &quot;amount&quot;: &quot;0.010&quot;}&#39; -H &quot;Content-Type: application/json&quot; -X POST http://localhost:12000/example
</pre></div>


</li>
<li>
<p>List argo workflows to list the <code>noise-processor-</code> and <code>matcher-workflow-</code> </p>
<div class="codehilite"><pre><span></span>argo list
</pre></div>


</li>
<li>
<p>Check the noisy image in bucket <code>output</code>.</p>
</li>
<li>
<p>As soon as the <code>matcher-workflow-</code> completes, you will see a message on NATS subject</p>
<div class="codehilite"><pre><span></span>`[#1] Received on [image-match]: &#39;FAILURE: 0.4500723255991941&#39;`
</pre></div>


</li>
<li>
<p>Lets change the parameters for the curl request to get &gt;80% match,</p>
<div class="codehilite"><pre><span></span>curl -d &#39;{&quot;filterA&quot;:&quot;5&quot;, &quot;filterB&quot;: &quot;5&quot;, &quot;sVSp&quot;: &quot;0.008&quot;, &quot;amount&quot;: &quot;0.0008&quot;}&#39; -H &quot;Content-Type: application/json&quot; -X POST http://localhost:12000/example
</pre></div>


</li>
<li>
<p>Still only 51% match,</p>
<div class="codehilite"><pre><span></span>[#2] Received on [image-match]: &#39;FAILURE: 0.519408012194793&#39;
</pre></div>


</li>
<li>
<p>Lets reduce the amount of noise to 0.0008,</p>
<div class="codehilite"><pre><span></span>curl -d &#39;{&quot;filterA&quot;:&quot;5&quot;, &quot;filterB&quot;: &quot;5&quot;, &quot;sVSp&quot;: &quot;0.008&quot;, &quot;amount&quot;: &quot;0.0008&quot;}&#39; -H &quot;Content-Type: application/json&quot; -X POST http://localhost:12000/example
</pre></div>


</li>
<li>
<p>You will see a success message,</p>
<div class="codehilite"><pre><span></span>[#4] Received on [image-match]: &#39;SUCCESS: 0.9157008012270712&#39;
</pre></div>


</li>
<li>
<p>This was a simple image processing pipeline using Argo Events. You can easily set up CI pipelines, Machine Learning pipelines etc,
   using Argo Events and Argo Workflows.</p>
</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../setup/webhook/" title="Webhook" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Webhook
              </span>
            </div>
          </a>
        
        
          <a href="../../tutorials/01-introduction/" title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Introduction
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>